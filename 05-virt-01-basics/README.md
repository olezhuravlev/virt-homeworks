
# Домашнее задание к занятию "5.1. Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения."

## Задача 1

Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.

===

**Полная (она же аппаратная) виртуализация** поддерживается непосредственно на уровне "железа" - процессорная архитектура такова, что гостевые системы функционируют полностью независимо (хотя по факту и используют оборудование совместно), а также отсутствует зависимость гостевой архитектуры от хостовой. Такой подход предоставляет полную свободу в использовании ПО, а также модификации ядер гостевых машин.

**Паравиртуализация** требует модицикации ядра гостевой ОС - ядро гостевой машины должно "впустить" управляющие механизмы гипервизора, чтобы он мог этим ядром управлять.

**Виртуализация на уровне ОС** использует функции ядра самой ОС, разграничивая ресурсы хоста между гостевыми машинами. Например, в Linux это организовано с помощью механизмов пространств имён, что позволяет контейнеризировать приложения. И хотя приложения не нуждаются в модификации, чтобы быть запущенными в контейнерах, однако по сути - это изолированные процессы на одной и той же хостовой машине и, соответственно, используют одно и то же ядро ОС.

---
## Задача 2

Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.

Организация серверов:
- физические сервера,
- паравиртуализация,
- виртуализация уровня ОС.

Условия использования:
- Высоконагруженная база данных, чувствительная к отказу.
- Различные web-приложения.
- Windows системы для использования бухгалтерским отделом.
- Системы, выполняющие высокопроизводительные расчеты на GPU.

Опишите, почему вы выбрали к каждому целевому использованию такую организацию.

===

**Будем использовать:**
- Высоконагруженная база данных, чувствительная к отказу:
  - физические сервера во избежание конкуренции за ресурсы с другими гостевыми ОС;
- Различные Java-приложения:
  - виртуализация на уровне ОС для оптимального использования ресурсов в случае изменения нагрузки. Здесь можно использовать механизмы контейнеризации.
- Windows системы для использования Бухгалтерским отделом:
  - паравиртуализация для унификации программного обеспечения, оперативного обновления и контроля работы клиенских машин. 
- Системы, выполняющие высокопроизводительные расчеты на GPU
  - физические сервера во избежание конкуренции за ресурсы с другими гостевыми ОС.

---
## Задача 3

Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

Сценарии:

1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
2. Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.
4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

===
1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
   1. Если нет особых требований (это не банк, не хранилище персональных данных или иной другой чувствительной информации), то можно использовать публичные сервисы;
   2. В целом, балансировку, репликацию и бэкап тем или иным способом можно реализовать на любой инфраструктуре, но 100 машин, это не так уж и мало и существует вопрос поддержки всего этого;
   3. Наиболее разумным способом здесь представляется использование облачных сервисов, таких, например, как **AWS EC2** или его аналога.


2. Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
   1. Т.к. нужно бесплатное open source решение, то VMWare и Hyper-V заведомо не подходят;
   2. OpenVZ не особо популярен, а значит, на рынке мало инженеров, знакомых с ним;
   3. Из популярных остаются KVM и Xen, но Xen сложнее обслуживать в смешанном (Linux/Win) окружении;
   4. Разумным выбором будет **KVM**.


3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.
   1. Т.к. нужно бесплатное решение, то VMWare и Hyper-V заведомо не подходят;
   2. Бесплатным является Xen, но Xen HVM в Windows-среде работает хуже, чем KVM, хотя Xen PV работает нормально;
   3. Лучшим выбором будет использование **Xen PV**, обладающее высокой производительностью, стабильностью и нормально работающее для Windows-сред.


4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.
   1. Если дистрибутивы разные, значить виртуализация на уровне ОС не подходит, поскольку ядро было бы одинаковым;
   1. Если речь о тестировании на разных дистрибутивах, то новые дистрибутивы будут появляться в дальнейшем, а, значит, нужна скорость и простота их добавления в набор виртуальных машин;
   2. Т.к. используется только Linux, то лучшим выбором будет **KVM** по соображениям простоты настройки, производительности и бесплатности.


В целом, по очкам выигрывает KVM, на котором, при желании, можно реализовать все указанные конфигурации инфраструктуры.

---
## Задача 4

Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

===

Проблемы гетерогенных сред проистекают из отсутствия стандартов систем виртуализации и, как следствие, возможных конфликтов между ними.
Интеграция различных гипервизоров друг с другом может оказаться нестандартной задачей, что сразу приводит к снижению надёжности, безопасности, повышению издержек и повышенным требованиям к инженерам, которые д.б. знать все используемые системы, а также конкретный применённый способ их интеграции.
Кроме того, даже имея доступ к официальной поддержке от вендора она может оказаться бесполезной, т.к. нацелена на стандартные решения, а зоопарк систем к таковым не относится.

Для минимизации рисков в случае использования гетерогенных систем должен быть разработан и строго соблюдаться внутренний стандарт их использования и интеграции, а также наличествовать квалифицированный инженерный персонал.

В целом, преимущества от использования гетерогенных систем (как совокупность их достоинств) не перевешивают недостатков их поддержки.
Конкретный пример мне сложно привести, потому что в реальной работе я с гетерогенными системами не сталкивался, но опыт использования прочих программных систем говорит, что рост сложности поддержки таких систем имеет **экспоненциальный** характер при росте их разнородности.
